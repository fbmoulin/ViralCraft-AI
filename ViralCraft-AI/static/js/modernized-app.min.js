// Vers√£o minificada e otimizada do modernized-app.js
document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("loading-screen"),t=document.getElementById("main-content"),n=document.getElementById("status-container"),a=document.getElementById("form-container"),r=document.getElementById("result-container");function o(){i(),checkSystemStatus().then(()=>{s(),c(),d(),l(),setTimeout(u,1500)}).catch(t=>{v("Erro ao inicializar aplica√ß√£o: "+t.message,"error"),u()})}function i(){e&&e.classList.remove("fade-out")}function u(){e&&(e.classList.add("fade-out"),setTimeout(()=>{e.style.display="none"},500))}async function checkSystemStatus(){try{const e=await fetch("/api/health"),t=await e.json();return n&&function(e){const t=document.querySelector('.status-value[data-status="uptime"]');t&&(t.textContent=e.uptime||"0s");const n=document.querySelector('.status-value[data-status="ai"]');if(n){const t=e.services?.openai?.configured||e.services?.anthropic?.configured;n.innerHTML=t?'<span class="status-dot"></span> Ativo':'<span class="status-dot" style="background-color: var(--color-error)"></span> Inativo'}const a=document.querySelector('.status-value[data-status="database"]');if(a){const t=e.services?.database?.connected;a.innerHTML=t?'<span class="status-dot"></span> Conectado':'<span class="status-dot" style="background-color: var(--color-error)"></span> Desconectado'}const r=document.querySelector('.status-value[data-status="server"]');r&&(r.innerHTML='<span class="status-dot"></span> Online'),v("Status atualizado!","info")}(t),t}catch(e){throw console.error("Erro ao verificar status:",e),v("N√£o foi poss√≠vel conectar ao servidor","error"),e}}function s(){const e=document.querySelectorAll(".tab"),t=document.querySelectorAll(".tab-content");e.length&&t.length&&(e.forEach(n=>{n.addEventListener("click",()=>{e.forEach(e=>e.classList.remove("active")),t.forEach(e=>e.classList.remove("active")),n.classList.add("active");const a=n.getAttribute("data-tab"),r=document.getElementById(a);r&&r.classList.add("active"),function(){const e=document.querySelector(".progress-bar-fill"),t=document.querySelectorAll(".tab"),n=Array.from(t).findIndex(e=>e.classList.contains("active"));if(e&&-1!==n){const a=n/(t.length-1)*100;e.style.width=`${a}%`;const r=document.querySelectorAll(".progress-step");r.forEach((e,t)=>{t<n?(e.classList.add("completed"),e.classList.remove("active")):t===n?(e.classList.add("active"),e.classList.remove("completed")):e.classList.remove("active","completed")})}}()})}),e[0].click())}function c(){document.querySelectorAll(".form-input, .form-select, .form-textarea").forEach(e=>{e.addEventListener("blur",()=>{p(e)}),e.addEventListener("input",()=>{const t=e.parentElement.querySelector(".error-message");t&&t.remove(),e.classList.remove("error")})})}function p(e){const t=e.value.trim(),n=e.hasAttribute("required");if(e.parentElement.querySelector(".error-message")&&e.parentElement.querySelector(".error-message").remove(),n&&""===t)return m(e,"Este campo √© obrigat√≥rio"),!1;if("email"===e.type&&""!==t){if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t))return m(e,"Email inv√°lido"),!1}if("url"===e.type&&""!==t)try{new URL(t)}catch(t){return m(e,"URL inv√°lida"),!1}return!0}function m(e,t){e.classList.add("error");const n=document.createElement("div");n.className="error-message",n.style.color="var(--color-error)",n.style.fontSize="0.75rem",n.style.marginTop="0.25rem",n.textContent=t,e.parentElement.appendChild(n)}function d(){document.querySelectorAll('input[type="file"]').forEach(e=>{const t=e.parentElement.querySelector(".file-upload-button"),n=e.parentElement.querySelector(".file-preview");t&&t.addEventListener("click",()=>{e.click()}),e.addEventListener("change",()=>{e.files.length>0&&function(e,t,n){if(!t)return;t.innerHTML="",t.style.display="block",n&&(n.textContent=e.name),e.type.startsWith("image/")?(a=document.createElement("img"),a.style.maxWidth="100%",a.style.maxHeight="150px",a.style.borderRadius="var(--border-radius-sm)",a.style.marginTop="var(--spacing-sm)",r=new FileReader,r.onload=e=>{a.src=e.target.result},r.readAsDataURL(e),t.appendChild(a)):(o=document.createElement("div"),o.className="file-info",o.style.display="flex",o.style.alignItems="center",o.style.gap="var(--spacing-sm)",o.style.marginTop="var(--spacing-sm)",i=document.createElement("span"),i.textContent=function(e){return e.startsWith("image/")?"üñºÔ∏è":"application/pdf"===e?"üìÑ":e.includes("word")?"üìù":e.includes("excel")||e.includes("spreadsheet")?"üìä":e.includes("text/")?"üìÉ":"üìé"}(e.type),i.style.fontSize="1.5rem",u=document.createElement("span"),u.textContent=e.name,u.style.wordBreak="break-all",o.appendChild(i),o.appendChild(u),t.appendChild(o));var a,r,o,i,u}(e.files[0],n,t)})})}function l(){const e=document.getElementById("content-form"),t=document.getElementById("generate-button"),n=document.getElementById("suggest-button");e&&(t&&t.addEventListener("click",async n=>{if(n.preventDefault(),!function(e){let t=!0;return e.querySelectorAll("[required]").forEach(e=>{p(e)||(t=!1)}),t}(e))return void v("Por favor, corrija os erros no formul√°rio","error");t.disabled=!0,t.innerHTML='<span class="spinner"></span> Gerando...';try{await async function(e){const t=new FormData(e),n={};for(const[e,a]of t.entries())"keywords"===e?n[e]=a.split(",").map(e=>e.trim()).filter(e=>e):"file"===e?a.size>0&&(n.file=a):n[e]=a;if(n.file)try{const e=await async function(e){const t=new FormData;t.append("file",e),t.append("type",e.type);try{const n=await fetch("/api/extract",{method:"POST",body:t});if(!n.ok){const e=await n.json();throw new Error(e.error||"Erro ao extrair conte√∫do do arquivo")}return await n.json()}catch(e){throw console.error("Erro na extra√ß√£o:",e),e}}(n.file);n.extractedData=e}catch(e){console.error("Erro ao extrair conte√∫do do arquivo:",e),v("N√£o foi poss√≠vel processar o arquivo","error")}try{const e=await fetch("/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!e.ok){const t=await e.json();throw new Error(t.error||"Erro ao gerar conte√∫do")}const t=await e.json();!function(e){if(!r)return;r.classList.remove("hidden");const t=r.querySelector(".result-content");if(!t)return;t.innerHTML=e.content||"Nenhum conte√∫do gerado";const n=r.querySelector(".result-actions");if(n){n.innerHTML="";const t=document.createElement("button");t.className="btn btn-primary",t.innerHTML='<span>üìã</span> Copiar',t.addEventListener("click",()=>{!function(e){const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-9999px",document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),v("Conte√∫do copiado para a √°rea de transfer√™ncia!","success")}(e.content)});const a=document.createElement("button");a.className="btn btn-secondary",a.innerHTML='<span>üíæ</span> Salvar',a.addEventListener("click",()=>{!function(e,t){const n=document.createElement("a");n.href="data:text/plain;charset=utf-8,"+encodeURIComponent(e),n.download=t||"conteudo-gerado.txt",n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),v("Conte√∫do salvo como arquivo de texto!","success")}(e.content,`conteudo-${new Date().toISOString().slice(0,10)}.txt`)});const o=document.createElement("button");o.className="btn btn-secondary",o.innerHTML='<span>üîÑ</span> Regenerar',o.addEventListener("click",()=>{document.getElementById("generate-button").click()}),n.appendChild(t),n.appendChild(a),n.appendChild(o)}}(t),v("Conte√∫do gerado com sucesso!","success"),r&&r.scrollIntoView({behavior:"smooth"})}catch(e){throw console.error("Erro na gera√ß√£o:",e),e}}(e),t.disabled=!1,t.innerHTML="‚ú® Gerar Conte√∫do"}catch(e){t.disabled=!1,t.innerHTML="‚ú® Gerar Conte√∫do",v("Erro ao gerar conte√∫do: "+e.message,"error")}}),n&&n.addEventListener("click",async t=>{t.preventDefault();const a=e.querySelector('input[name="topic"]');if(!a||!a.value.trim())return m(a,"Informe um t√≥pico para receber sugest√µes"),void v("Informe um t√≥pico para receber sugest√µes","error");n.disabled=!0,n.innerHTML='<span class="spinner"></span> Sugerindo...';try{await async function(e){const t=new FormData(e),n={};for(const[e,a]of t.entries())"keywords"===e?n[e]=a.split(",").map(e=>e.trim()).filter(e=>e):n[e]=a;try{const e=await fetch("/api/suggest",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!e.ok){const t=await e.json();throw new Error(t.error||"Erro ao sugerir conte√∫do")}const t=await e.json();!function(e){const t=document.getElementById("suggestion-container");if(!t)return;t.classList.remove("hidden"),t.innerHTML="";const n=document.createElement("div");n.className="card",n.innerHTML=`
        <div class="card-header">
          <h2 class="card-title">üí° Sugest√µes para seu Conte√∫do</h2>
        </div>
        <div class="suggestion-content">
          ${e.suggestions.map(e=>`
            <div class="suggestion-item">
              <h3>${e.title}</h3>
              <p>${e.description}</p>
              <button class="btn btn-secondary btn-sm use-suggestion" data-suggestion="${encodeURIComponent(JSON.stringify(e))}">Usar esta ideia</button>
            </div>
          `).join("")}
        </div>
        <div class="flex justify-between mt-6">
          <button class="btn btn-secondary close-suggestions">Fechar</button>
        </div>
      `,t.appendChild(n);const a=t.querySelector(".close-suggestions");a&&a.addEventListener("click",()=>{t.classList.add("hidden")});t.querySelectorAll(".use-suggestion").forEach(e=>{e.addEventListener("click",()=>{const n=JSON.parse(decodeURIComponent(e.getAttribute("data-suggestion")));!function(e){const t=document.getElementById("content-form");if(!t)return;const n=t.querySelector('input[name="topic"]');n&&(n.value=e.title);const a=t.querySelector('textarea[name="additionalContext"]');a&&(a.value=(a.value?a.value+"\n\n":"")+e.description);const r=t.querySelector('input[name="keywords"]');if(r&&e.keywords){const t=r.value?r.value.split(",").map(e=>e.trim()).filter(e=>e):[];e.keywords.forEach(e=>{t.includes(e)||t.push(e)}),r.value=t.join(", ")}v("Sugest√£o aplicada ao formul√°rio!","success"),t.querySelector(".tab[data-tab='tab-basic']").click()}(n),t.classList.add("hidden")})})}(t),v("Sugest√£o gerada com sucesso!","success")}catch(e){throw console.error("Erro na sugest√£o:",e),e}}(e),n.disabled=!1,n.innerHTML="üí° Sugerir Ideias"}catch(e){n.disabled=!1,n.innerHTML="üí° Sugerir Ideias",v("Erro ao sugerir conte√∫do: "+e.message,"error")}}))}function v(e,t){const n=document.createElement("div");n.className=`notification notification-${t||"info"}`,n.innerHTML=`
    <div class="notification-icon">${function(e){switch(e){case"success":return"‚úÖ";case"error":return"‚ùå";case"warning":return"‚ö†Ô∏è";default:return"‚ÑπÔ∏è"}}(t)}</div>
    <div class="notification-content">${e}</div>
  `,document.body.appendChild(n),setTimeout(()=>{n.style.opacity="0",setTimeout(()=>{document.body.removeChild(n)},300)},3e3)}o(),document.querySelectorAll(".next-tab").forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("data-next"),n=document.querySelector(`.tab[data-tab="${t}"]`);n&&n.click()})}),document.querySelectorAll(".prev-tab").forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("data-prev"),n=document.querySelector(`.tab[data-tab="${t}"]`);n&&n.click()})}),window.addEventListener("load",()=>{document.documentElement.style.setProperty("--vh",`${.01*window.innerHeight}px`)}),window.addEventListener("resize",()=>{document.documentElement.style.setProperty("--vh",`${.01*window.innerHeight}px`)})});
